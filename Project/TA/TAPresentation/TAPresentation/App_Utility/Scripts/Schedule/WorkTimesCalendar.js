var J0000=1721424.5;var J1970=2440587.5;var JMJD=2400000.5;var J1900=2415020.5;var J1904=2416480.5;var GREGORIAN_EPOCH=1721425.5;var PERSIAN_EPOCH=1948320.5;var MonthDays=new Array(31,31,31,31,31,31,30,30,30,30,30,29);var curMDay=0;var curMMonth=0;var curMYear=0;var curPDay=0;var curPMonth=0;var curPYear=0;var MasterObj="ctl00_ContentPlaceHolder1_";var oldPDay=0;var oldPMonth=0;var oldPYear=0;var newPDay=0;var newPMonth=0;var newPYear=0;var curMonthDays=0;var oldMonthDays=0;var newMonthDays=0;var firstDayMonth=0;pageLoad();function pageLoad(){window.name="WorkTimesCalendar.aspx";aspnetForm.target="WorkTimesCalendar.aspx";document.getElementById("OToolBar_BtnSave").style.display="none";curPYear=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(0,4));curPMonth=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(5,2));curPDay=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(8,2));var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(document.getElementById(MasterObj+"txtXmlShiftNobatKariRel").value);var g;g=e.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation[GroupID="+document.getElementById(MasterObj+"cmbGroup").value+"]");if(g.length!=0){document.getElementById(MasterObj+"cmbSchedule").value=g.item(0).selectSingleNode("ScheduleId").text}if(document.getElementById(MasterObj+"txtTempDate").value!=""){curPYear=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(0,4));if(document.getElementById(MasterObj+"txtTempDate").value.substr(5,1)=="0"){curPMonth=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(6,1))}else{curPMonth=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(5,2))}if(document.getElementById(MasterObj+"txtTempDate").value.substr(8,1)=="0"){curPDay=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(9,1))}else{curPDay=parseInt(document.getElementById(MasterObj+"txtTempDate").value.substr(8,2))}}else{var d=new Date();curMDay=d.getDate();curMMonth=d.getMonth();curMYear=d.getFullYear();var f;f=JD2Persian(Gregorian2JD(curMYear,curMMonth+1,curMDay));curPYear=f[0];curPMonth=f[1];curPDay=f[2]}if(document.getElementById(MasterObj+"txtSelYear").value==""){document.getElementById(MasterObj+"cmbYear").value=curPYear}else{curPYear=parseInt(document.getElementById(MasterObj+"txtSelYear").value)}if(document.getElementById(MasterObj+"txtSelMonth").value==""){document.getElementById(MasterObj+"cmbMonth").value=curPMonth}else{curPMonth=parseInt(document.getElementById(MasterObj+"txtSelMonth").value)}if(document.getElementById(MasterObj+"txtSelDay").value!=""){curPDay=parseInt(document.getElementById(MasterObj+"txtSelDay").value)}fnFillInCells();if(document.getElementById(MasterObj+"opPersonName").checked){opPersonNameOnClick()}else{if(document.getElementById(MasterObj+"opShiftNobatKari").checked){opShiftNobatKariOnClick();var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(document.getElementById(MasterObj+"txtXmlShiftNobatKariRel").value);var g;if(document.getElementById(MasterObj+"cmbSchedule").value==0){g=e.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation");document.getElementById(MasterObj+"cmbGroup").innerHTML="";optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(0).innerText="انتخاب نشده";document.getElementById(MasterObj+"cmbGroup").all(0).value=0;if(g.length!=0){var b=1;for(var c=0;c<g.length;++c){optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(b).innerText=g.item(c).selectSingleNode("GroupName").text;document.getElementById(MasterObj+"cmbGroup").all(b).value=g.item(c).selectSingleNode("GroupID").text;b++}}document.getElementById(MasterObj+"cmbGroup").value=0}else{var a=document.getElementById(MasterObj+"cmbGroup").value;g=e.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation[ScheduleId="+document.getElementById(MasterObj+"cmbSchedule").value+"]");document.getElementById(MasterObj+"cmbGroup").innerHTML="";optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(0).innerText="انتخاب نشده";document.getElementById(MasterObj+"cmbGroup").all(0).value=0;if(g.length!=0){var b=1;for(var c=0;c<g.length;++c){optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(b).innerText=g.item(c).selectSingleNode("GroupName").text;document.getElementById(MasterObj+"cmbGroup").all(b).value=g.item(c).selectSingleNode("GroupID").text;b++}}if(g.length==1){document.getElementById(MasterObj+"cmbGroup").value=g.item(0).selectSingleNode("GroupID").text}else{document.getElementById(MasterObj+"cmbGroup").value=a}}}}if($get(MasterObj+"txtAlert").value!=""){SetMsg($get(MasterObj+"txtAlert").value);$get(MasterObj+"txtAlert").value=""}}function opShiftNobatKariOnClick(){document.getElementById(MasterObj+"cmbSchedule").disabled=false;document.getElementById(MasterObj+"cmbGroup").disabled=false;document.getElementById(MasterObj+"cmbPersonName").value=0;document.getElementById(MasterObj+"txtPersonID").value="";document.getElementById(MasterObj+"cmbPersonName").disabled=true;document.getElementById(MasterObj+"txtPersonID").disabled=true;document.getElementById(MasterObj+"txtXMLSave").value="";document.getElementById("OToolBar_BtnSave").style.display="none"}function opPersonNameOnClick(){document.getElementById(MasterObj+"cmbPersonName").disabled=false;document.getElementById(MasterObj+"txtPersonID").disabled=false;document.getElementById(MasterObj+"cmbSchedule").value=0;document.getElementById(MasterObj+"cmbGroup").value=0;var d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(document.getElementById(MasterObj+"txtXmlShiftNobatKariRel").value);var e;if(document.getElementById(MasterObj+"cmbSchedule").value==0){e=d.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation");document.getElementById(MasterObj+"cmbGroup").innerHTML="";optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(0).innerText="انتخاب نشده";document.getElementById(MasterObj+"cmbGroup").all(0).value=0;if(e.length!=0){var b=1;for(var c=0;c<e.length;++c){optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(b).innerText=e.item(c).selectSingleNode("GroupName").text;document.getElementById(MasterObj+"cmbGroup").all(b).value=e.item(c).selectSingleNode("GroupID").text;b++}}document.getElementById(MasterObj+"cmbGroup").value=0}else{var a=document.getElementById(MasterObj+"cmbGroup").value;e=d.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation[ScheduleId="+document.getElementById(MasterObj+"cmbSchedule").value+"]");document.getElementById(MasterObj+"cmbGroup").innerHTML="";optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(0).innerText="انتخاب نشده";document.getElementById(MasterObj+"cmbGroup").all(0).value=0;if(e.length!=0){var b=1;for(var c=0;c<e.length;++c){optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(b).innerText=e.item(c).selectSingleNode("GroupName").text;document.getElementById(MasterObj+"cmbGroup").all(b).value=e.item(c).selectSingleNode("GroupID").text;b++}}if(e.length==1){document.getElementById(MasterObj+"cmbGroup").value=e.item(0).selectSingleNode("GroupID").text}else{document.getElementById(MasterObj+"cmbGroup").value=0}}document.getElementById(MasterObj+"cmbSchedule").disabled=true;document.getElementById(MasterObj+"cmbGroup").disabled=true}function txtPersonIDOnBlur(a){if((a.value!=0)||(a.value!=0)){document.getElementById(MasterObj+"cmbPersonName").value=a.value;if((document.getElementById(MasterObj+"cmbPersonName").value==0)||(document.getElementById(MasterObj+"cmbPersonName").value=="")){alert("شماره پرسنلي معتبر نيست!");a.value=""}else{btnSeachOnClick()}}else{a.value="";document.getElementById(MasterObj+"cmbPersonName").value=0;btnSeachOnClick()}}function cmbPersonNameOnChange(a){document.getElementById(MasterObj+"txtPersonID").value=a.value;if(a.value==0){document.getElementById(MasterObj+"txtPersonID").value="";return}btnSeachOnClick()}function cmbScheduleOnChange(e){var d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(document.getElementById(MasterObj+"txtXmlShiftNobatKariRel").value);var f;if(e.value==0){f=d.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation");document.getElementById(MasterObj+"cmbGroup").innerHTML="";optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(0).innerText="انتخاب نشده";document.getElementById(MasterObj+"cmbGroup").all(0).value=0;if(f.length!=0){var b=1;for(var c=0;c<f.length;++c){optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(b).innerText=f.item(c).selectSingleNode("GroupName").text;document.getElementById(MasterObj+"cmbGroup").all(b).value=f.item(c).selectSingleNode("GroupID").text;b++}}document.getElementById(MasterObj+"cmbGroup").value=0}else{var a=document.getElementById(MasterObj+"cmbGroup").value;f=d.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation[ScheduleId="+e.value+"]");document.getElementById(MasterObj+"cmbGroup").innerHTML="";optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(0).innerText="انتخاب نشده";document.getElementById(MasterObj+"cmbGroup").all(0).value=0;if(f.length!=0){var b=1;for(var c=0;c<f.length;++c){optionEl=document.createElement("OPTION");document.getElementById(MasterObj+"cmbGroup").options.add(optionEl);document.getElementById(MasterObj+"cmbGroup").all(b).innerText=f.item(c).selectSingleNode("GroupName").text;document.getElementById(MasterObj+"cmbGroup").all(b).value=f.item(c).selectSingleNode("GroupID").text;b++}}if(f.length==1){document.getElementById(MasterObj+"cmbGroup").value=f.item(0).selectSingleNode("GroupID").text;btnSeachOnClick()}else{document.getElementById(MasterObj+"cmbGroup").value=0}}}function cmbGroupOnChange(b){var a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(document.getElementById(MasterObj+"txtXmlShiftNobatKariRel").value);var c;c=a.documentElement.selectNodes("/ScheduleEntity/ShiftNobatKariRelation[GroupID="+b.value+"]");if(c.length!=0){document.getElementById(MasterObj+"cmbSchedule").value=c.item(0).selectSingleNode("ScheduleId").text}if(b.value!=0){btnSeachOnClick()}}function btnSeachOnClick(){var a="";var b="";a=document.getElementById(MasterObj+"cmbYear").value+"/"+document.getElementById(MasterObj+"cmbMonth").value+"/01";b=document.getElementById(MasterObj+"cmbYear").value+"/"+document.getElementById(MasterObj+"cmbMonth").value+"/";if(document.getElementById(MasterObj+"cmbMonth").value>=1&&document.getElementById(MasterObj+"cmbMonth").value<=6){b=b+31}else{if(document.getElementById(MasterObj+"cmbMonth").value>=7&&document.getElementById(MasterObj+"cmbMonth").value<=11){b=b+30}else{if(document.getElementById(MasterObj+"cmbMonth").value==12){if(LeapPersian(document.getElementById(MasterObj+"cmbYear").value)){b=b+30}else{b=b+MonthDays[document.getElementById(MasterObj+"cmbMonth").value-1]}}}}document.getElementById(MasterObj+"txtSDate").value=a;document.getElementById(MasterObj+"txtEDate").value=b;if(document.getElementById(MasterObj+"opShiftNobatKari").checked){if((document.getElementById(MasterObj+"cmbSchedule").value==0)||(document.getElementById(MasterObj+"cmbSchedule").value=="")){alert("يک شيفت را انتخاب نماييد.");document.getElementById(MasterObj+"cmbSchedule").focus();fnFillInCells();return}}else{if(document.getElementById(MasterObj+"opPersonName").checked){if((document.getElementById(MasterObj+"cmbPersonName").value==0)||(document.getElementById(MasterObj+"cmbPersonName").value=="")){alert("پرسنل مورد نظر را انتخاب نماييد.");document.getElementById(MasterObj+"cmbPersonName").focus();fnFillInCells();return}}}document.getElementById(MasterObj+"txtNobatKari").value=document.getElementById(MasterObj+"cmbGroup").value;document.getElementById(MasterObj+"txtSubmit").value="Search";OpenModelPopup();document.getElementById(MasterObj+"BtnSubmit").click()}var lastselectedcell;var lastselectedrow;var lastselectedcellclass;function cellDayOnClick(a){if(grdDetail.rows(parseInt(a.parentElement.rowIndex/4)*4).cells(a.cellIndex).className=="CssOffDay"){return}curPDay=grdDetail.rows(parseInt(a.parentElement.rowIndex/4)*4).cells(a.cellIndex).innerText;document.getElementById(MasterObj+"txtSelDay").value=curPDay;if(lastselectedrow!=null){lastselectedcell.className=lastselectedcellclass;grdDetail.rows(lastselectedrow).cells(lastselectedcell).className=lastselectedcellclass;grdDetail.rows(lastselectedrow+1).cells(lastselectedcell).className=lastselectedcellclass;grdDetail.rows(lastselectedrow+2).cells(lastselectedcell).className=lastselectedcellclass;grdDetail.rows(lastselectedrow+3).cells(lastselectedcell).className=lastselectedcellclass}lastselectedcellclass=grdDetail.rows(parseInt(a.parentElement.rowIndex/4)*4).cells(a.cellIndex).className;lastselectedrow=parseInt(a.parentElement.rowIndex/4)*4;lastselectedcell=a.cellIndex;grdDetail.rows(parseInt(a.parentElement.rowIndex/4)*4).cells(a.cellIndex).className="CssDaySelected";grdDetail.rows(parseInt(a.parentElement.rowIndex/4)*4+1).cells(a.cellIndex).className="CssDaySelected";grdDetail.rows(parseInt(a.parentElement.rowIndex/4)*4+2).cells(a.cellIndex).className="CssDaySelected";grdDetail.rows(parseInt(a.parentElement.rowIndex/4)*4+3).cells(a.cellIndex).className="CssDaySelected"}function cmbMonthOnChnage(a){document.getElementById(MasterObj+"txtSelMonth").value=a.value;curPMonth=a.value;btnSeachOnClick()}function cmbYearOnChange(a){document.getElementById(MasterObj+"txtSelYear").value=a.value;curPYear=a.value;btnSeachOnClick()}function btnNextMonthOnClick(){if(curPMonth!=12){curPMonth=curPMonth+1;document.getElementById(MasterObj+"txtSelMonth").value=curPMonth;document.getElementById(MasterObj+"cmbMonth").value=curPMonth}else{if(curPMonth==12){curPMonth=1;document.getElementById(MasterObj+"txtSelMonth").value=curPMonth;document.getElementById(MasterObj+"cmbMonth").value=curPMonth;curPYear=curPYear+1;document.getElementById(MasterObj+"txtSelYear").value=curPYear;document.getElementById(MasterObj+"cmbYear").value=curPYear}}btnSeachOnClick()}function btnPrevMonthOnClick(){if(curPMonth!=1){curPMonth=curPMonth-1;document.getElementById(MasterObj+"txtSelMonth").value=curPMonth;document.getElementById(MasterObj+"cmbMonth").value=curPMonth}else{if(curPMonth==1){curPMonth=12;document.getElementById(MasterObj+"txtSelMonth").value=curPMonth;document.getElementById(MasterObj+"cmbMonth").value=curPMonth;curPYear=curPYear-1;document.getElementById(MasterObj+"txtSelYear").value=curPYear;document.getElementById(MasterObj+"cmbYear").value=curPYear}}btnSeachOnClick()}function btnNextYearOnClick(){curPYear=curPYear+1;document.getElementById(MasterObj+"txtSelYear").value=curPYear;document.getElementById(MasterObj+"cmbYear").value=curPYear;btnSeachOnClick()}function btnPrevYearOnClick(){curPYear=curPYear-1;document.getElementById(MasterObj+"txtSelYear").value=curPYear;document.getElementById(MasterObj+"cmbYear").value=curPYear;btnSeachOnClick()}function fnFillInCells(){if(document.getElementById(MasterObj+"txtXmlHoliday").value!=""){var l=new ActiveXObject("Microsoft.XMLDOM");l.async="false";l.loadXML(document.getElementById(MasterObj+"txtXmlHoliday").value);var d}var o=new ActiveXObject("Microsoft.XMLDOM");o.async="false";o.loadXML(document.getElementById(MasterObj+"txtXmlShiftNobatKari").value);var g;var b=0;var m=0;firstDayMonth=(SHDtoInt(curPYear+"/"+curPMonth+"/"+1)-1)%7;if(curPMonth==1){oldPYear=curPYear-1;oldPMonth=12;if(LeapPersian(oldPYear)){oldMonthDays=30}else{oldMonthDays=MonthDays[oldPMonth-1]}curMonthDays=MonthDays[curPMonth-1];newPYear=curPYear;newPMonth=curPMonth+1;newMonthDays=MonthDays[newPMonth-1]}else{if(curPMonth==12){oldPYear=curPYear;oldPMonth=curPMonth-1;oldMonthDays=MonthDays[oldPMonth-1];if(LeapPersian(curPYear)){curMonthDays=30}else{curMonthDays=MonthDays[curPMonth-1]}newPYear=curPYear+1;newPMonth=1;newMonthDays=MonthDays[newPMonth-1]}else{if(curPMonth==11){oldPYear=curPYear;oldPMonth=curPMonth-1;oldMonthDays=MonthDays[oldPMonth-1];curMonthDays=MonthDays[curPMonth-1];newPYear=curPYear;newPMonth=curPMonth+1;if(LeapPersian(curPYear)){newMonthDays=30}else{newMonthDays=MonthDays[newPMonth-1]}}else{oldPYear=curPYear;oldPMonth=curPMonth-1;oldMonthDays=MonthDays[oldPMonth-1];curMonthDays=MonthDays[curPMonth-1];newPYear=curPYear;newPMonth=curPMonth+1;newMonthDays=MonthDays[newPMonth-1]}}}for(var f=oldMonthDays-firstDayMonth+1;f<=oldMonthDays;++f){grdDetail.rows(m).cells(b).innerText=f;grdDetail.rows(m+1).cells(b).innerText=" ";grdDetail.rows(m+2).cells(b).innerText=" ";grdDetail.rows(m+3).cells(b).innerText=" ";grdDetail.rows(m).cells(b).className="CssOffDay";grdDetail.rows(m+1).cells(b).className="CssOffDay";grdDetail.rows(m+2).cells(b).className="CssOffDay";grdDetail.rows(m+3).cells(b).className="CssOffDay";if(b<6){++b}else{b=0;m=m+3}}for(var f=1;f<=curMonthDays;++f){grdDetail.rows(m).cells(b).innerText=f;g=o.documentElement.selectNodes("/ScheduleEntity/ShiftandNobatKari[FYear="+curPYear+"][FMonth="+curPMonth+"][FDay="+f+"]");if(g.length!=0){grdDetail.rows(m+1).cells(b).innerText=g.item(0).selectSingleNode("Shift").text;grdDetail.rows(m+1).cells(b).title=g.item(0).selectSingleNode("fShift").text;if(document.getElementById(MasterObj+"opPersonName").checked==true){grdDetail.rows(m+3).cells(b).childNodes(0).value=g.item(0).selectSingleNode("NewNobatKari").text}else{grdDetail.rows(m+3).cells(b).innerHTML=g.item(0).selectSingleNode("SNobatKari").text}grdDetail.rows(m+3).cells(b).title=g.item(0).selectSingleNode("fNobatKari").text;grdDetail.rows(m+2).cells(b).innerText=g.item(0).selectSingleNode("GGroup").text;grdDetail.rows(m+2).cells(b).title=g.item(0).selectSingleNode("fGroup").text}else{grdDetail.rows(m+3).cells(b).innerHTML=" "}if(curPDay==f){lastselectedcellclass="CssDay";lastselectedrow=m;lastselectedcell=b;grdDetail.rows(m).cells(b).className="CssDaySelected";grdDetail.rows(m+1).cells(b).className="CssDaySelected";grdDetail.rows(m+2).cells(b).className="CssDaySelected";grdDetail.rows(m+3).cells(b).className="CssDaySelected";d=l.documentElement.selectNodes("/GeneralEntity/Holidays[FYear="+curPYear+"][FMonth="+curPMonth+"][FDay="+f+"]");if(d.length==1){grdDetail.rows(m).cells(b).title=d.item(0).selectSingleNode("Descr").text;grdDetail.rows(m).cells(b).style.color="red"}if(g.length>0){if(g.item(0).selectSingleNode("NobatKari").text!=g.item(0).selectSingleNode("NewNobatKari").text){grdDetail.rows(m+1).cells(b).style.color="green";grdDetail.rows(m+2).cells(b).style.color="green";grdDetail.rows(m+3).cells(b).style.color="green"}else{try{grdDetail.rows(m+3).cells(b).childNodes(0).onmouseover=""}catch(k){}}}}else{d=l.documentElement.selectNodes("/GeneralEntity/Holidays[FYear="+curPYear+"][FMonth="+curPMonth+"][FDay="+f+"]");if(d.length==1){grdDetail.rows(m).cells(b).title=d.item(0).selectSingleNode("Descr").text;grdDetail.rows(m).cells(b).className="CssHoliday";grdDetail.rows(m+1).cells(b).className="CssHoliday";grdDetail.rows(m+2).cells(b).className="CssHoliday";grdDetail.rows(m+3).cells(b).className="CssHoliday";grdDetail.rows(m).cells(b).style.color="red"}else{grdDetail.rows(m).cells(b).className="CssDay";grdDetail.rows(m+1).cells(b).className="CssDay";grdDetail.rows(m+2).cells(b).className="CssDay";grdDetail.rows(m+3).cells(b).className="CssDay"}if(g.length>0){if(g.item(0).selectSingleNode("NobatKari").text!=g.item(0).selectSingleNode("NewNobatKari").text){grdDetail.rows(m+1).cells(b).style.color="green";grdDetail.rows(m+2).cells(b).style.color="green";grdDetail.rows(m+3).cells(b).style.color="green"}else{try{grdDetail.rows(m+3).cells(b).childNodes(0).onmouseover=""}catch(k){}}}}if(b<6){++b}else{b=0;m=m+4}}var c=grdDetail.rows.length;for(var f=1;(m<=c-3)&&(b<=6);++f){grdDetail.rows(m).cells(b).innerText=f;grdDetail.rows(m).cells(b).className="CssOffDay";grdDetail.rows(m+1).cells(b).className="CssOffDay";grdDetail.rows(m+2).cells(b).className="CssOffDay";grdDetail.rows(m+3).cells(b).className="CssOffDay";grdDetail.rows(m+3).cells(b).innerHTML=" ";if(b<6){++b}else{b=0;m=m+4}}var h=grdDetail.rows(0).cells.length;var n=0;for(f=0;f<c;f++){for(j=0;j<h;j++){if(grdDetail.rows(f).cells(j).innerText==""){grdDetail.rows(f).cells(j).innerText=" "}}}}function LoadGroup(c,b,a){document.getElementById(MasterObj+"txtSubmit").value=a;if(document.getElementById(MasterObj+"txtSubmit").value.length<2){a="0"+a}document.getElementById(MasterObj+"txtSubmit").value=b;if(document.getElementById(MasterObj+"txtSubmit").value.length<2){b="0"+b}var e=document.getElementById("cmbGroupSave");var d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(document.getElementById(MasterObj+"txtXmlShiftNobatKari").value);var f;f=d.documentElement.selectNodes("/ScheduleEntity/ShiftandNobatKari[FYear="+c+"][FMonth="+b+"][FDay="+a+"]");if(f.length>0){e.value=f.item(0).selectSingleNode("ShiftId").text;document.getElementById(MasterObj+"txtCurDate").value=c+"/"+b+"/"+a}}function Gregorian2JD(b,c,a){b=new Number(b);c=new Number(c);a=new Number(a);return(GREGORIAN_EPOCH-1)+(365*(b-1))+Math.floor((b-1)/4)+(-Math.floor((b-1)/100))+Math.floor((b-1)/400)+Math.floor((((367*c)-362)/12)+((c<=2)?0:(LeapGregorian(b)?-1:-2))+a)}function JD2Gregorian(k){k=new Number(k);var g,n,e,b,m,a,o,c,f,l,h,d,i;g=Math.floor(k-0.5)+0.5;n=g-GREGORIAN_EPOCH;e=Math.floor(n/146097);b=Mod(n,146097);m=Math.floor(b/36524);a=Mod(b,36524);o=Math.floor(a/1461);c=Mod(a,1461);f=Math.floor(c/365);h=(e*400)+(m*100)+(o*4)+f;if(!((m==4)||(f==4))){h++}d=g-Gregorian2JD(h,1,1);i=((g<Gregorian2JD(h,3,1))?0:(LeapGregorian(h)?1:2));month=Math.floor((((d+i)*12)+373)/367);day=(g-Gregorian2JD(h,month,1))+1;return new Array(h,month,day)}function LeapGregorian(a){return((a%4)==0)&&(!(((a%100)==0)&&((a%400)!=0)))}function LeapPersian(a){return((((((a-((a>0)?474:473))%2820)+474)+38)*682)%2816)<682}function Persian2JD(b,e,a){b=new Number(b);e=new Number(e);a=new Number(a);var d,c;d=b-((b>=0)?474:473);c=474+this.Mod(d,2820);return a+((e<=7)?((e-1)*31):(((e-1)*30)+6))+Math.floor(((c*682)-110)/2816)+(c-1)*365+Math.floor(d/2820)*1029983+(this.PERSIAN_EPOCH-1)}function Mod(d,c){return d-(c*Math.floor(d/c))}function JD2Persian(k){k=new Number(k);var h,g,i,l,e,a,f,d,c,b;k=Math.floor(k)+0.5;l=k-Persian2JD(475,1,1);e=Math.floor(l/1029983);a=Mod(l,1029983);if(a==1029982){f=2820}else{d=Math.floor(a/366);c=Mod(a,366);f=Math.floor(((2134*d)+(2816*c)+2815)/1028522)+d+1}h=f+(2820*e)+474;if(h<=0){h--}b=(k-Persian2JD(h,1,1))+1;g=(b<=186)?Math.ceil(b/31):Math.ceil((b-6)/30);i=(k-Persian2JD(h,g,1))+1;return new Array(h,g,i)}function ValidPersianDate(b,d,a){if(isNaN(parseInt(b,10))||parseInt(b,10)<0||isNaN(parseInt(d,10))||parseInt(d,10)<0||parseInt(d,10)>12||isNaN(parseInt(a,10))||parseInt(a,10)<0||parseInt(a,10)>32){return false}var c=(d>=1&&d<=6&&a<=31);c=c||(d>=7&&d<=11&&a<=30);c=c||(LeapPersian(b)&&d==12&&a<=30);c=c||(!LeapPersian(b)&&d==12&&a<=29);return c}function PersianDateAdd(d,f,b,e,c){var a=new Array();a[0]=d;a[1]=f;a[2]=b;if(c==0){a[0]=d+e;if(a[0]<=0){a[0]=0;return a}if(!LeapPersian(a[0])&&f==12&&b==30){a[2]=29}}if(c==1){a[1]=f+e;if(a[1]==0){a[0]=d-1;a[1]=12;a[2]=((LeapPersian(a[0]))?30:29);return a}if(a[1]==13){a[0]=d+1;a[1]=1;a[2]=1;return a}if(a[1]==12&&!LeapPersian(a[0])&&b==30){a[2]=29;return a}if(a[1]>=7&&a[1]<=11&&b==31){a[2]=20;return a}}if(c==2){a[2]=b+e;if(a[2]==0){if(a[1]==1){a[0]=d-1;a[1]=12;a[2]=((LeapPersian(a[0]))?30:29);return a}if(a[1]>=2&&a[1]<=7){a[1]=f-1;a[2]=31;return a}if(a[1]>=8&&a[1]<=12){a[1]=f-1;a[2]=30;return a}}if(a[1]>=1&&a[1]<=6&&a[2]==32){a[1]=f+1;a[2]=1;return a}if(a[1]>=7&&a[1]<=11&&a[2]==31){a[1]=f+1;a[2]=1;return a}if(a[1]==12&&LeapPersian(a[0])&&a[2]==31){a[0]=d+1;a[1]=1;a[2]=1;return a}if(a[1]==12&&!LeapPersian(a[0])&&a[2]==30){a[0]=d+1;a[1]=1;a[2]=1;return a}}return a}function onchangeLcombo(c){var a=curPYear+"/"+curPMonth+"/"+curPDay;if(document.getElementById(MasterObj+"opShiftNobatKari").checked==true){return}if((document.getElementById(MasterObj+"opPersonName").checked==true)&&(document.getElementById(MasterObj+"txtPersonID").value=="")){alert("لطفا شماره پرسنلي را وارد نماييد.");return}if(c.value==0){alert("لطفا نوبت کاري روز "+a+" را انتخاب نماييد.");return}if(document.getElementById(MasterObj+"txtXMLSave").value==""){document.getElementById(MasterObj+"txtXMLSave").value="<BaseInfoEntity>"}document.getElementById(MasterObj+"txtXMLSave").value+="</BaseInfoEntity>";var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(document.getElementById(MasterObj+"txtXMLSave").value);var e;e=b.documentElement.selectNodes("/BaseInfoEntity/DetailCollection[ODate='"+a+"']");if(e.length>0){e.item(0).selectSingleNode("DetailCollectionID").text=c.value;document.getElementById(MasterObj+"txtXMLSave").value=b.xml;document.getElementById(MasterObj+"txtXMLSave").value=document.getElementById(MasterObj+"txtXMLSave").value.substr(0,document.getElementById(MasterObj+"txtXMLSave").value.length-17)}else{document.getElementById(MasterObj+"txtXMLSave").value=document.getElementById(MasterObj+"txtXMLSave").value.substr(0,document.getElementById(MasterObj+"txtXMLSave").value.length-17);var d="";d+="<DetailCollection>";d+="<PersonID>"+document.getElementById(MasterObj+"txtPersonID").value+"</PersonID>";d+="<ODate>"+a+"</ODate>";d+="<DetailCollectionID>"+c.value+"</DetailCollectionID>";d+="</DetailCollection>";document.getElementById(MasterObj+"txtXMLSave").value+=d}if((document.getElementById(MasterObj+"txtXMLSave").value!="")&&(document.getElementById(MasterObj+"opPersonName").checked==true)){document.getElementById("OToolBar_BtnSave").style.display="inline"}}function OnClickBtnSave(){document.getElementById(MasterObj+"txtAcCode").value=GetAccessCode(window.event.srcElement);OpenModelPopup();document.getElementById(MasterObj+"txtXMLSave").value+="</BaseInfoEntity>";document.getElementById(MasterObj+"txtSubmit").value="SaveShift";document.getElementById(MasterObj+"BtnSubmit").click()}var oPopup=window.createPopup();function onmouseoverLcombo(c){var b=oPopup.document.body;b.style.backgroundColor="#ffffcc";b.style.fontSize="11px";b.style.fontWeight="bold";b.style.fontFamily="Traffic";b.dir="rtl";b.document.body.innerText=c.parentElement.title;var a=event.screenX;var e=event.screenY;var d=c.parentElement.offsetTop;oPopup.show(a,e,140,18)}function onmouseoutLcombo(){try{oPopup.hide()}catch(a){}}function OnClickBtnCancel(){window.close()}function onClickImgRefreshPerson(){OpenModelPopup();document.getElementById(MasterObj+"txtSubmit").value="ImgRefreshPerson";document.getElementById(MasterObj+"ImgRefreshPersonSubmit").click()};