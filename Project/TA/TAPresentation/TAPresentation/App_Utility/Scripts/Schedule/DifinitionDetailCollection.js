var MasterObj="ctl00_ContentPlaceHolder1_";var newrowindex=0;var LastSelectedRow=null;var lastValue="";var doNothingFlag=0;var ID=0;var NameValue="";var DescValue="";var Acronym="";var txtTimesStructure="";var Mode=0;BindPage();if($get(MasterObj+"txtReport").value=="1"){$get("tdToolbar").style.display="none"}function BindPage(){Mode=$get(MasterObj+"txtMode").value;var d="";if($get(MasterObj+"txtXml").value!=""){var f=$get(MasterObj+"txtXml").value;var a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(f);var b=a.documentElement.selectNodes("/ScheduleEntity/DetailCollectionDescription");if(b.length>0){var c=b.item(0).selectSingleNode("StartDate").text;var e=b.item(0).selectSingleNode("EndDate").text;$get(MasterObj+"txtDesc").value=b.item(0).selectSingleNode("Desc").text;$get(MasterObj+"KCalSDate_txtDay").value=c.substr(8,2);$get(MasterObj+"KCalSDate_txtMonth").value=c.substr(5,2);$get(MasterObj+"KCalSDate_txtYear").value=c.substr(0,4);$get(MasterObj+"KCalSDate_txtCalendar").value=$get(MasterObj+"KCalSDate_txtDay").value+"/"+$get(MasterObj+"KCalSDate_txtMonth").value+"/"+$get(MasterObj+"KCalSDate_txtYear").value;$get(MasterObj+"KCalSDate_txtCalendar").value=$get(MasterObj+"KCalSDate_txtCalendar").value+"  "+F_adbsghh($get(MasterObj+"KCalSDate_txtDay").value+"/"+$get(MasterObj+"KCalSDate_txtMonth").value+"/"+$get(MasterObj+"KCalSDate_txtYear").value);$get(MasterObj+"KCalEDate_txtDay").value=e.substr(8,2);$get(MasterObj+"KCalEDate_txtMonth").value=e.substr(5,2);$get(MasterObj+"KCalEDate_txtYear").value=e.substr(0,4);$get(MasterObj+"KCalEDate_txtCalendar").value=$get(MasterObj+"KCalEDate_txtDay").value+"/"+$get(MasterObj+"KCalEDate_txtMonth").value+"/"+$get(MasterObj+"KCalEDate_txtYear").value;$get(MasterObj+"KCalEDate_txtCalendar").value=$get(MasterObj+"KCalEDate_txtCalendar").value+"  "+F_adbsghh($get(MasterObj+"KCalEDate_txtDay").value+"/"+$get(MasterObj+"KCalEDate_txtMonth").value+"/"+$get(MasterObj+"KCalEDate_txtYear").value);d=b.item(0).selectSingleNode("TimesStructure").text}}createRows(d)}function createRows(h){var m="";if(Mode==1){m="روز قبل"}else{m="روز جاري"}if(h==""){if(Mode==1){insertChildTable(0,"روز جاري","آزاد بعد وقت","10052","00:00","23:59","0");document.getElementById("grdSub").rows(0).cells(0).firstChild.disabled=false}else{insertChildTable(0,"روز جاري","آزاد بعد وقت","10053","00:00","23:59","0");document.getElementById("grdSub").rows(0).cells(0).firstChild.disabled=true}}else{var b=h.split(";");var c="";var a="";var l="";l=b[0].split("$");c=l[0].split("_");a=l[1].split(",");if(c[1]>=0&&c[1]<1440){m="روز جاري"}else{if(c[1]<0){m="روز قبل"}}var f=0;for(var g=0;g<b.length-1;g++){l=b[g].split("$");c=l[0].split("_");a=l[1].split(",");insertChildTable(f,m,getDetailTypeTitle(a[0]),a[0],GetTime(c[0]),GetTime(c[1]),"0");f++;for(var e=1;e<a.length;e++){insertChildTable(f,m,getDetailTypeTitle(a[e]),a[e],"0","0","0");f++}if(GetTime(c[1])=="23:59"){if(m=="روز جاري"){m="<font color='red'>روز بعد</font>"}else{if(m=="روز قبل"){m="<font color='green'>روز جاري</font>"}}}}for(var d=document.getElementById("grdSub").rows.length-1;d>0;d--){if(document.getElementById("grdSub").rows(d).cells(3).innerText=="روز بعد"&&document.getElementById("grdSub").rows(d).cells(0).innerHTML!=""){document.getElementById("grdSub").rows(d).cells(6).style.display="inline";return}}}if(Mode==1){document.getElementById("grdSub").rows(0).cells(0).firstChild.disabled=false}}function getDetailTypeTitle(b){var c=new ActiveXObject("Microsoft.XMLDOM");c.loadXML(document.getElementById(MasterObj+"txtDetailType").value);c.setProperty("SelectionLanguage","XPath");var a=c.documentElement.selectNodes("/ScheduleEntity/GetDetailType[DetailTypeID="+b+"]");if(a.length>0){return a.item(0).selectSingleNode("Title").text}else{return""}}function GetTime(d){if(parseInt(d)<0){d=parseInt(d)+1440}else{if(parseInt(d)>1439){d=parseInt(d)-1440}}var a=d/60;a=parseInt(a,10);var b=d%60;b=parseInt(b,10);var c="";if(a<10){c="0"+a+":"}else{c=a+":"}if(b<10){c+="0"+b}else{c+=b}return c}function insertChildTable(g,b,f,a,e,c,d){oGrid=document.getElementById("grdSub");oGrid.insertRow();oGrid.rows(g).insertCell();oGrid.rows(g).insertCell();oGrid.rows(g).insertCell();oGrid.rows(g).insertCell();oGrid.rows(g).insertCell();oGrid.rows(g).insertCell();oGrid.rows(g).insertCell();oGrid.rows(g).className="CssItemHeader2";oGrid.rows(g).setAttribute("Caption",b);oGrid.rows(g).setAttribute("Selected",d);oGrid.rows(g).setAttribute("DetailTypeID",a);if(e.toString()!="0"){oGrid.rows(g).cells(0).innerHTML="<INPUT type='text' class='txtControls' style='WIDTH:40px'disabled value='"+e+"'  title='"+e+"' onkeydown='chekTime(this.value)' onblur='validTime(this),onBlurTxtSTime(this)' onfocus='onfocusTxtTime(this)' />"}else{oGrid.rows(g).cells(0).innerText=""}if(c.toString()!="0"){oGrid.rows(g).cells(1).innerHTML="<INPUT type='text' class='txtControls' style='WIDTH:40px' value='"+c+"'  title='"+c+"' onkeydown='chekTime(this.value)' onchange='validTime(this),onBlurTxtEndTime(this)' onfocus='onfocusTxtTime(this)'/>"}else{oGrid.rows(g).cells(1).innerText=""}oGrid.rows(g).cells(2).innerHTML="<asp:Label  runat='server'>"+f+"</asp:Label>";oGrid.rows(g).cells(3).innerHTML="<asp:Label  runat='server'>"+b+"</asp:Label>";oGrid.rows(g).cells(6).innerHTML="<INPUT type='button' title='جديد'  style='BORDER-RIGHT: #346fa4 2px solid; BORDER-TOP: lightsteelblue 2px solid; BACKGROUND-IMAGE: url(/TA/Includes/Images/Icons/NewIcon.gif); BORDER-LEFT: lightsteelblue 2px solid; WIDTH: 24px; CURSOR: pointer; BORDER-BOTTOM: #346fa4 2px solid; BACKGROUND-REPEAT: no-repeat; HEIGHT: 22px; BACKGROUND-COLOR:#D5E1FD'  onclick='onclickBtnNewRow()'>";oGrid.rows(g).cells(5).innerHTML="<INPUT type='button'  title='حذف'  style='BORDER-RIGHT: #346fa4 2px solid; BORDER-TOP: lightsteelblue 2px solid; BACKGROUND-IMAGE: url(/TA/Includes/Images/Icons/DelIcon.gif); BORDER-LEFT: lightsteelblue 2px solid; WIDTH: 24px; CURSOR: pointer; BORDER-BOTTOM: #346fa4 2px solid; BACKGROUND-REPEAT: no-repeat; HEIGHT: 22px; BACKGROUND-COLOR:#D5E1FD'  onclick='onclickbtnDeleteRow(this)'>";oGrid.rows(g).cells(4).innerHTML="<INPUT type='button' title='خصوصيات' style='BORDER-RIGHT: #346fa4 2px solid; BORDER-TOP: lightsteelblue 2px solid; BACKGROUND-IMAGE: url(/TA/Includes/Images/Icons/Pro.gif); BORDER-LEFT: lightsteelblue 2px solid; WIDTH: 24px; CURSOR: pointer; BORDER-BOTTOM: #346fa4 2px solid; BACKGROUND-REPEAT: no-repeat; HEIGHT: 22px; BACKGROUND-COLOR:#D5E1FD'  onclick='onclickBtnProperties()' >";oGrid.rows(g).align="center";oGrid.rows(g).cells(6).style.display="none";oGrid.rows(g).cells(0).style.width="90px";oGrid.rows(g).cells(1).style.width="90px";oGrid.rows(g).cells(2).style.width="150px";oGrid.rows(g).cells(3).style.width="110px";oGrid.rows(g).cells(4).style.width="24px";oGrid.rows(g).cells(5).style.width="24px";oGrid.rows(g).cells(6).style.width="24px"}function onclickBtnProperties(){var a=window.event.srcElement;for(var e=0;a.tagName!="TR";e++){a=a.parentElement}var k=document.getElementById("grdSub");a.Selected="1";var d=a.rowIndex;if(a.cells(0).innerHTML==""){return}var l=d+1;var b=1;var h=k.rows(d).DetailTypeID;while(k.rows(l)!=null&&k.rows(l).cells(0)!=null&&k.rows(l).cells(0).innerHTML==""){h+=","+k.rows(l).DetailTypeID;l++;b++}url="/TA/TAPeresentation/Pages/BaseInfo/DayStructureProperties.aspx";var g="";g=window.showModalDialog(url,h,"dialogHeight:520px;dialogWidth: 220px;dialogleft: 5PX;help: no;scroll:no;status:no");if(g==""||g==undefined){return}var m=new ActiveXObject("Microsoft.XMLDOM");m.loadXML(g);m.setProperty("SelectionLanguage","XPath");var f;f=m.documentElement.selectNodes("/BaseInfoEntity/GetDetailType");if(f.length>0){a.Selected="1";a.cells(2).firstChild.innerText=f.item(0).selectSingleNode("Title").text;a.DetailTypeID=f.item(0).selectSingleNode("DetailTypeID").text;l=d+1;while(k.rows(l)!=null&&k.rows(l).cells(0)!=null&&k.rows(l).cells(0).innerHTML==""){k.deleteRow(l)}for(var c=1;c<f.length;c++){insertChildTable(d+c,a.Caption,f.item(c).selectSingleNode("Title").text,f.item(c).selectSingleNode("DetailTypeID").text,0,0,"1")}}}function onclickBtnNewRow(){var e=window.event.srcElement;for(var g=0;e.tagName!="TR";g++){e=e.parentElement}var d=document.getElementById("grdSub");var h=e.rowIndex+1;var c=e.rowIndex;e.Selected="1";if(d.rows(h)!=null){while(d.rows(h)!=null&&d.rows(h).cells(1)!=null&&d.rows(h).cells(1).innerHTML==""){h=h+1}}if(e.cells(1).firstChild.value=="23:59"||e.cells(1).firstChild.value==""){return}var b=addTime(e.cells(1).firstChild.value);var f=e.cells(0).firstChild.value;var a=compareTimes(e.cells(1).firstChild.value,e.cells(0).firstChild.value);if(a==true){insertChildTable(h,"<font color='red'>روز بعد</font>","","",b,b,"1");d.rows(c).cells(6).style.display="none";d.rows(h).cells(6).style.display="inline";d.rows(h).cells(1).firstChild.focus();d.rows(h).cells(1).firstChild.select()}else{alert("ساعت خاتمه بايد بزرگتر از ساعت شروع باشد");e.cells(1).firstChild.focus();e.cells(1).firstChild.select()}}function onfocusTxtTime(a){lastValue=a.value;a.select()}function onBlurTxtEndTime(a){if(Mode==1){fMode1(a)}else{fMode0(a)}}function fMode1(g){for(var h=0;g.tagName!="TR";h++){g=g.parentElement}var f=document.getElementById("grdSub");if(doNothingFlag==1){doNothingFlag=0;return}g.Selected="1";var k=g.rowIndex+1;var d=k;if(g.cells(1).firstChild.value==""){alert("لطفا ساعت خروج را وارد کنيد");g.cells(1).firstChild.focus();return}else{if(g.cells(1).firstChild.value=="23:59"){if(g.cells(3).firstChild.innerText=="روز قبل"){while(f.rows(k)!=null&&f.rows(k).cells(1)!=null&&f.rows(k).cells(1).innerHTML==""){k++}if(f.rows(k)==null){insertChildTable(k,"<font color=green>روز جاري</font>","","","00:00","23:59","1")}else{while(f.rows(k)!=null&&f.rows(k).cells(3)!=null&&f.rows(k).cells(3).firstChild.innerText!="روز جاري"){f.deleteRow(k)}g.cells(1).firstChild.title=g.cells(1).firstChild.value}return}else{if(g.cells(3).firstChild.innerText=="روز جاري"){while(f.rows(k)!=null){f.deleteRow(k)}g.cells(1).firstChild.title=g.cells(1).firstChild.value;return}}}}if(g.cells(0).firstChild.value==g.cells(1).firstChild.value||compareTimes(g.cells(0).firstChild.value,g.cells(1).firstChild.value)==true){alert("ساعت خاتمه بايد بزرگتر از ساعت شروع باشد");g.cells(1).firstChild.focus();g.cells(1).firstChild.select();return}if(f.rows(k)!=null){if(g.cells(1).firstChild.value!=lastValue){var c=confirm("آيا براي تغيير مطمئن هستيد؟");if(c==false){g.cells(1).firstChild.value=lastValue;return}}}g.cells(1).firstChild.title=g.cells(1).firstChild.value;if(f.rows(k)==null){var e=addTime(g.cells(1).firstChild.value);var b=g.cells(3).firstChild.innerText;b=g.cells(1).firstChild.value<=e?b:"روز قبل";insertChildTable(k,b,"","",e,"23:59","1");f.rows(k).cells(1).firstChild.focus();f.rows(k).cells(1).firstChild.select();return}for(;k<f.rows.length;k++){while(f.rows(k)!=null&&f.rows(k).cells(1)!=null&&f.rows(k).cells(1).innerHTML==""){k++}while(f.rows(k)!=null&&f.rows(k).cells(1)!=null&&f.rows(k).cells(1).innerHTML!=""&&compareTimes(f.rows(k).cells(1).firstChild.value,g.cells(1).firstChild.value)==false){f.deleteRow(k);while(f.rows(k)!=null&&f.rows(k).cells(1)!=null&&f.rows(k).cells(1).innerHTML==""){f.deleteRow(k)}}}while(f.rows(d)!=null&&f.rows(d).cells(1)!=null&&f.rows(d).cells(1).innerHTML==""){d++}if(f.rows(d)!=null){if(f.rows(d).cells(3).firstChild.innerText=="روز جاري"&&f.rows(d-1).cells(3).firstChild.innerText=="روز قبل"){var e=addTime(g.cells(1).firstChild.value);var b=g.cells(3).firstChild.innerText;b=g.cells(1).firstChild.value<=e?b:"روز قبل";insertChildTable(d,b,"","",e,"23:59","1");f.rows(d).cells(1).firstChild.focus();f.rows(d).cells(1).firstChild.select()}else{f.rows(d).cells(0).firstChild.value=addTime(g.cells(1).firstChild.value)}lastValue=""}else{var e=addTime(g.cells(1).firstChild.value);var b=g.cells(3).firstChild.innerText;b=g.cells(1).firstChild.value<=e?b:"روز قبل";insertChildTable(d,b,"","",e,"23:59","","1");f.rows(d).cells(1).firstChild.focus();f.rows(d).cells(1).firstChild.select()}}function fMode0(f){for(var g=0;f.tagName!="TR";g++){f=f.parentElement}var e=document.getElementById("grdSub");if(doNothingFlag==1){doNothingFlag=0;return}else{if(lastValue==f.cells(1).firstChild.value||lastValue==""){return}}f.Selected="1";var h=f.rowIndex+1;var c=h;if(f.cells(1).firstChild.value==""){alert("لطفا ساعت خروج را وارد کنيد");f.cells(1).firstChild.focus();return}else{if(f.cells(1).firstChild.value=="23:59"){if(e.rows(h)!=null&&e.rows(h).cells(3)!=null&&e.rows(h).cells(3).firstChild.innerText=="روز بعد"){return}else{if(e.rows(h)==null){return}}while(e.rows(h)!=null&&e.rows(h).cells(0)!=null&&e.rows(h).cells(0).innerHTML==""){h++}if(e.rows(h)!=null&&e.rows(h).cells(3)!=null&&e.rows(h).cells(3).firstChild.innerText=="روز بعد"){return}else{var b=confirm("آيا براي تغيير مطمئن هستيد؟");if(b==true){while(e.rows(h)!=null&&e.rows(h).cells(0)!=null&&e.rows(h).cells(0).innerHTML==""){h++}while(e.rows(h)!=null&&e.rows(h).cells(3)!=null&&e.rows(h).cells(3).firstChild.innerText!="روز بعد"){e.deleteRow(h)}}return}}}if(f.cells(3).firstChild.innerText=="روز بعد"){if(f.cells(0).firstChild.value==f.cells(1).firstChild.value||compareTimes(f.cells(0).firstChild.value,f.cells(1).firstChild.value)==true){alert("ساعت خاتمه بايد بزرگتر از ساعت شروع باشد");f.cells(1).firstChild.focus();f.cells(1).firstChild.select();return}else{f.cells(1).firstChild.title=f.cells(1).firstChild.value;while(e.rows(h)!=null&&e.rows(h).cells(1)!=null&&e.rows(h).cells(1).innerHTML==""){h++}while(e.rows(h)!=null){e.deleteRow(h)}if(e.rows(e.rows.length-1).cells(3).firstChild.innerText=="روز بعد"&&parseInt(e.rows(e.rows.length-1).cells(1).firstChild.value.replace(":",""))<2359){e.rows(e.rows.length-1).cells(6).innerHTML="<INPUT type='button' title='جديد'  style='BORDER-RIGHT: #346fa4 2px solid; BORDER-TOP: lightsteelblue 2px solid; BACKGROUND-IMAGE: url(/TA/Includes/Images/Icons/NewIcon.gif); BORDER-LEFT: lightsteelblue 2px solid; WIDTH: 24px; CURSOR: pointer; BORDER-BOTTOM: #346fa4 2px solid; BACKGROUND-REPEAT: no-repeat; HEIGHT: 22px; BACKGROUND-COLOR:#D5E1FD'  onclick='onclickBtnNewRow()'>";e.rows(e.rows.length-1).cells(6).style.display="inline";e.rows(e.rows.length-1).cells(6).style.width="24px"}return}}if(e.rows(h)!=null){if(f.cells(1).firstChild.value!=lastValue){var b=confirm("آيا براي تغيير مطمئن هستيد؟");if(b==false){f.cells(1).firstChild.value=lastValue;return}}}f.cells(1).firstChild.title=f.cells(1).firstChild.value;if(compareTimes(f.cells(0).firstChild.value,f.cells(1).firstChild.value)==true){for(;h<e.rows.length;h++){while(e.rows(h)!=null&&e.rows(h).cells(1)!=null&&e.rows(h).cells(1).innerHTML==""){h++}c=h;while(e.rows(h)!=null){e.deleteRow(h)}}var d=addTime(f.cells(1).firstChild.value);f.cells(1).firstChild.value="23:59";f.cells(1).firstChild.title="23:59";insertChildTable(c,"<font color=red>روز بعد</font>","","","00:00",d,"1");e.rows(c).cells(6).style.display="inline";e.rows(c).cells(1).firstChild.focus();e.rows(c).cells(1).firstChild.select();return}if(e.rows(h)==null){var d=addTime(f.cells(1).firstChild.value);insertChildTable(h,f.Caption,"","",d,"23:59","1");e.rows(h).cells(1).firstChild.focus();e.rows(h).cells(1).firstChild.select();return}for(;h<e.rows.length;h++){while(e.rows(h)!=null&&e.rows(h).cells(1)!=null&&e.rows(h).cells(1).innerHTML==""){h++}while(e.rows(h)!=null&&e.rows(h).cells(1)!=null&&e.rows(h).cells(1).innerHTML!=""&&e.rows(h).cells(3).firstChild.innerText!="روز بعد"&&compareTimes(e.rows(h).cells(1).firstChild.value,f.cells(1).firstChild.value)==false){e.deleteRow(h);while(e.rows(h)!=null&&e.rows(h).cells(1)!=null&&e.rows(h).cells(1).innerHTML==""){e.deleteRow(h)}}}while(e.rows(c)!=null&&e.rows(c).cells(1)!=null&&e.rows(c).cells(1).innerHTML==""){c++}if(e.rows(c)!=null){if(e.rows(c).cells(3).firstChild.innerText=="روز بعد"){var d=addTime(f.cells(1).firstChild.value);insertChildTable(c,f.Caption,"","",d,"23:59","1");e.rows(c).cells(1).firstChild.focus();e.rows(c).cells(1).firstChild.select()}else{e.rows(c).cells(0).firstChild.value=addTime(f.cells(1).firstChild.value)}lastValue=""}else{var d=addTime(f.cells(1).firstChild.value);insertChildTable(c,f.Caption,"","",d,"23:59","","1");e.rows(c).cells(1).firstChild.focus();e.rows(c).cells(1).firstChild.select()}}function validTime(f){var g="";g=ReplaceAll(f.value," ","");if((g!="")&&(IsvalidTime(g)==false)){var c;var e;c="  ! لطفا دراين قسمت ساعت صحيح وارد كنيد";c=alert(c,0,"ساعت اشتباه ");f.focus();doNothingFlag=1;return}else{if((g!="")&&(IsvalidTime(g)==true)){var a;if(getCntChar(":",g)==0){a=g;if(a.length==1){a="0"+a+":00"}else{if(a.length==2){a=a+":00"}else{if(a.length==4){a=a.substr(0,2)+":"+a.substr(2,2)}}}g=a}else{a=g.split(":");var d=a[0];var b=a[1];if(d.length==0){d="00"}else{if(d.length==1){d="0"+d}}if(b.length==0){b="00"}else{if(b.length==1){b="0"+b}}g=d+":"+b}f.value=g}}}function IsvalidTime(c){var f;var e;var g;var b;var a;var d;var h;if(getCntChar(":",c)>1){return(false)}else{if(getCntChar(":",c)==0){if(c.length==2){if(c>23){doNothingFlag=1;return(false)}else{return(true)}}if(c.length==4){d=c.substr(0,2);h=c.substr(2,2);if(d>23||h>59){doNothingFlag=1;return(false)}else{return(true)}}if(c.length==1||c.length==2){return(true)}else{if(c.length>2){doNothingFlag=1;return(false)}}if(c.length>2){doNothingFlag=1;return(false)}}else{a=c.split(":");g=parseInt(a[0]);b=parseInt(a[1]);if(g>23||b>59){doNothingFlag=1;return(false)}else{return(true)}}}}function chekTime(b){var a=window.event.keyCode;window.event.returnValue=(((a>=96)&&(a<=105))||((a>=48)&&(a<=57))||(a==8)||(a==9)||(a==46)||((a>=35)&&(a<=40))||(a==186))}function addTime(c){if(c==""){return}var a;a=c.split(":");var b=parseInt(a[1],10);var d=parseInt(a[0],10);if(b>=0&&b<9){b=b+1;b="0"+b}else{if(b==59){d=d+1;b="00"}else{if(b>=9){b=b+1}}}if(d<10){c="0"+d+":"+b}else{c=d+":"+b}return c}function onclickbtnDeleteRow(a){if(Mode==1){deleteMode1(a)}else{deleteMode0(a)}}function compareTimes(d,c){if(d==""||c==""){return false}var b;var a;b=d.split(":");a=c.split(":");b[0]=parseInt(b[0],10);b[1]=parseInt(b[1],10);a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10);if(b[0]>a[0]){return true}else{if(b[0]==a[0]){if(b[1]>a[1]){return true}else{return false}}else{return false}}}function deleteMode1(e){for(var f=0;e.tagName!="TR";f++){e=e.parentElement}var d=document.getElementById("grdSub");var h=e.rowIndex;e.Selected="1";if(e.cells(1).innerHTML==""){return}else{if((d.rows(h+1))==null&&(h-1)==-1){return}}if(!confirm("آيا براي حذف مطمئن هستيد؟")){return}else{if(e.cells(3).firstChild.innerText=="روز جاري"&&(h-1)!=-1){var a=h-1;for(var f=0;d.rows(a).cells(1).innerHTML=="";f++){a=a-1}var g=0;for(var c=0;c<d.rows.length;c++){if(d.rows(c).cells(3).firstChild.innerText=="روز جاري"&&d.rows(c).cells(1).innerHTML!=""){g++}}if(g>1&&d.rows(a).cells(3).firstChild.innerText=="روز قبل"){alert("حذف امکان پذير نمي باشد");return}if(d.rows(a).cells(3).firstChild.innerText!="روز قبل"){d.rows(a).cells(1).firstChild.value=d.rows(h).cells(1).firstChild.value}d.deleteRow(h);while(d.rows(h)!=null&&d.rows(h).cells(1)!=null&&d.rows(h).cells(1).innerHTML==""){d.deleteRow(h)}setTitles(d);setSTime(d)}else{if(d.rows(h+1)==null){d.deleteRow(h);while(d.rows(h)!=null&&d.rows(h).cells(1)!=null&&d.rows(h).cells(1).innerHTML==""){d.deleteRow(h)}var f=d.rows.length-1;while(d.rows(f)!=null&&d.rows(f).cells(1)!=null&&d.rows(f).cells(1).innerHTML==""){f--}d.rows(f).cells(1).firstChild.value="23:59";setTitles(d)}else{if((h-1)==-1){var b=h+1;var f=1;if(d.rows(b).cells(1).innerHTML==""){while(d.rows(b)!=null&&d.rows(b).cells(1)!=null&&d.rows(b).cells(1).innerHTML==""){f++;b++}}if(d.rows(b)==null){return}else{if(d.rows(b).cells(3).firstChild.innerText=="روز جاري"){alert("امکان پذير نمي باشد");return}}for(j=0;j<f;j++){d.deleteRow(h)}setTitles(d);setSTime(d);return}else{var a=h-1;if(a!=-1){for(var f=0;d.rows(a).cells(1).innerHTML=="";f++){a=a-1}}d.rows(a).cells(1).firstChild.value=d.rows(h).cells(1).firstChild.value;d.deleteRow(h);while(d.rows(h)!=null&&d.rows(h).cells(1)!=null&&d.rows(h).cells(1).innerHTML==""){d.deleteRow(h)}setTitles(d)}}}}}function setTitles(a){for(var b=0;b<a.rows.length;b++){if(a.rows(b).cells(1).innerHTML!=""){a.rows(b).cells(0).firstChild.title=a.rows(b).cells(0).firstChild.value;a.rows(b).cells(1).firstChild.title=a.rows(b).cells(1).firstChild.value}}}function setSTime(a){for(var b=0;b<a.rows.length;b++){if(a.rows(b).cells(1).innerHTML!=""&&a.rows(b).cells(3).firstChild.innerText=="روز جاري"){a.rows(b).cells(0).firstChild.value="00:00";a.rows(b).cells(0).firstChild.title="00:00";return}}}function deleteMode0(d){for(var f=0;d.tagName!="TR";f++){d=d.parentElement}var c=document.getElementById("grdSub");var g=d.rowIndex;d.Selected="1";if(d.cells(1).innerHTML==""){return}else{if((c.rows(g+1))==null&&(g-1)==-1){return}}if(!confirm("آيا براي حذف مطمئن هستيد؟")){return}else{if(d.cells(3).firstChild.innerText=="روز بعد"&&(g-1)!=-1){while(c.rows(g)!=null){c.deleteRow(g)}setTitles(c);for(var e=c.rows.length-1;e>=0;e--){if(c.rows(e).cells(3).firstChild.innerText=="روز بعد"&&c.rows(e).cells(0).innerHTML!=""&&c.rows(e).cells(6).style.display=="none"){c.rows(e).cells(6).style.display="inline";return}}}else{if(c.rows(g+1)==null){c.deleteRow(g);while(c.rows(g)!=null&&c.rows(g).cells(1)!=null&&c.rows(g).cells(1).innerHTML==""){c.deleteRow(g)}var f=c.rows.length-1;while(c.rows(f)!=null&&c.rows(f).cells(1)!=null&&c.rows(f).innerHTML==""){f--}c.rows(f).cells(1).firstChild.value="23:59";setTitles(c)}else{if((g-1)==-1){var b=g+1;var f=1;if(c.rows(b).cells(1).innerHTML==""){while(c.rows(b)!=null&&c.rows(b).cells(1)!=null&&c.rows(b).cells(1).innerHTML==""){f++;b++}}if(c.rows(b)==null){return}else{if(c.rows(b).cells(3).firstChild.innerText=="روز بعد"){alert("امکان پذير نمي باشد");return}}for(e=0;e<f;e++){c.deleteRow(g)}c.rows(g).cells(0).firstChild.value="00:00";setTitles(c)}else{var a=g-1;if(a!=-1){for(var f=0;c.rows(a).cells(1).innerHTML=="";f++){a=a-1}}c.rows(a).cells(1).firstChild.value=c.rows(g).cells(1).firstChild.value;c.deleteRow(g);while(c.rows(g)!=null&&c.rows(g).cells(1)!=null&&c.rows(g).cells(1).innerHTML==""){c.deleteRow(g)}setTitles(c)}}}}}function OnClickBtnCancel(){window.close()}function OnClickBtnNew(){$get(MasterObj+"KCalSDate_txtDay").value="";$get(MasterObj+"KCalSDate_txtMonth").value="";$get(MasterObj+"KCalSDate_txtYear").value="";$get(MasterObj+"KCalEDate_txtDay").value="";$get(MasterObj+"KCalEDate_txtMonth").value="";$get(MasterObj+"KCalEDate_txtYear").value="";$get(MasterObj+"KCalSDate_txtCalendar").value="";$get(MasterObj+"KCalEDate_txtCalendar").value="";$get(MasterObj+"txtDesc").value="";$get(MasterObj+"txtDetailCollectionID").value="0";Cleargrd(document.getElementById("grdSub"));createRows("")}function Cleargrd(a){j=a.rows.length-1;for(;j>=0;--j){a.deleteRow(j)}newrowindex=0}function OnClickBtnSave(){if(checkNotEmpty()==true){if(MakeXML()==true){document.getElementById(MasterObj+"txtSubmit").value="Save";document.getElementById(MasterObj+"BtnSubmit").click()}}}function MakeXML(){var a=$get(MasterObj+"KCalSDate_txtYear").value+"/"+$get(MasterObj+"KCalSDate_txtMonth").value+"/"+$get(MasterObj+"KCalSDate_txtDay").value;var b=$get(MasterObj+"KCalEDate_txtYear").value+"/"+$get(MasterObj+"KCalEDate_txtMonth").value+"/"+$get(MasterObj+"KCalEDate_txtDay").value;if(MakeXMLTimesStructure()==false){return false}var c="<Tb>";c=c+"<Desc>"+document.getElementById(MasterObj+"txtDesc").value+"</Desc>";c=c+"<SDate>"+a+"</SDate>";c=c+"<EDate>"+b+"</EDate>";c=c+"<TimesStructure>"+txtTimesStructure+"</TimesStructure>";c=c+"<StructureID>"+document.getElementById(MasterObj+"txtStructureID").value+"</StructureID>";c=c+"<DetailCollectionID>"+document.getElementById(MasterObj+"txtDetailCollectionID").value+"</DetailCollectionID>";c=c+"</Tb>";document.getElementById(MasterObj+"txtXMLSave").value="<Root>"+c+"</Root>";return true}function GetMinute(c,b){if(c==""){return 0}var a;a=c.split(":");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10);if(b=="روز قبل"){return((a[0]*60+a[1])-1440)}else{if(b=="<FONT color=red>روز بعد</FONT>"){return((a[0]*60+a[1])+1440)}else{return(a[0]*60+a[1])}}}function MakeXMLTimesStructure(){var h=document.getElementById("grdSub");var g="";var b=0;var c=0;var f=0;var a=0;var e=1;var d;while(c<h.rows.length){if(h.rows(c).cells(2).firstChild.innerText==""){alert("لطفا نوع ساختار را مشخص کنيد");c++;f=1;return false}else{if(h.rows(c).Selected=="1"){a=1;e=0}caption=h.rows(c).cells(3).firstChild.innerHTML;g+=GetMinute((h.rows(c).cells(0).firstChild.value),caption).toString()+"_";g+=GetMinute((h.rows(c).cells(1).firstChild.value),caption).toString()+"$";g+=h.rows(c).DetailTypeID;b=c+1;if(h.rows(b)!=null&&h.rows(b).cells(0)!=null&&h.rows(b).cells(0).innerHTML==""){while(h.rows(b)!=null&&h.rows(b).cells(0)!=null&&h.rows(b).cells(0).innerHTML==""){g+=","+h.rows(b).DetailTypeID;b++;c=b}}else{c++}g+=";"}}txtTimesStructure=g;return true}function checkNotEmpty(){if($get(MasterObj+"KCalSDate_txtYear").value+"/"+$get(MasterObj+"KCalSDate_txtMonth").value+"/"+$get(MasterObj+"KCalSDate_txtDay").value=="//"){alert("تاريخ شروع را وارد نماييد");return false}else{if($get(MasterObj+"KCalEDate_txtYear").value+"/"+$get(MasterObj+"KCalEDate_txtMonth").value+"/"+$get(MasterObj+"KCalEDate_txtDay").value=="//"){alert("تاريخ پايان را وارد نماييد");return false}else{if(document.getElementById(MasterObj+"txtDesc").value==""){alert("شرح را وارد نماييد");$get(MasterObj+"txtDesc").focus();return false}else{if(!CompareTime()){return}}}}return true}function CompareTime(){try{var a=document.getElementById(MasterObj+"KCalEDate_txtYear").value+document.getElementById(MasterObj+"KCalEDate_txtMonth").value+document.getElementById(MasterObj+"KCalEDate_txtDay").value;var c=document.getElementById(MasterObj+"KCalSDate_txtYear").value+document.getElementById(MasterObj+"KCalSDate_txtMonth").value+document.getElementById(MasterObj+"KCalSDate_txtDay").value;if(a<c){alert("تاريخ پايان بايد بزرگتر از تاريخ شروع باشد");return false}else{return true}}catch(b){alert("اطلاعات نادرست است")}}function onBlurTxtSTime(a){var b=a.parentElement.parentElement;if(a.value!="00:00"){b.cells(3).firstChild.innerText="روز قبل"}};