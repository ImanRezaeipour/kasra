var LastSelectedRow=null;var LastSelectedRowClass="";var PageSize=10;var OSelectedMamber="";window.returnValue=0;$get(MasterObj+"txtSaveXml").value="<Root></Root>";Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(BeginRequestHandler);Sys.WebForms.PageRequestManager.getInstance().add_endRequest(EndRequestHandler);function BeginRequestHandler(b,a){document.getElementById("OToolBar_ProgressBar").style.visibility="visible"}function EndRequestHandler(c,b){document.getElementById("OToolBar_ProgressBar").style.visibility="hidden";var a=$get(MasterObj+"txtSubmit").value;if(a!=""){if(a=="Save"){$get(MasterObj+"txtSaveXml").value="<Root></Root>";if($get(MasterObj+"txtValidate").value=="1"){$get(MasterObj+"KCalSDate_txtYear").value="";$get(MasterObj+"KCalSDate_txtMonth").value="";$get(MasterObj+"KCalSDate_txtDay").value="";$get(MasterObj+"KCalEDate_txtYear").value="";$get(MasterObj+"KCalEDate_txtMonth").value="";$get(MasterObj+"KCalEDate_txtDay").value="";$get(MasterObj+"CmbCreditType").value="0";window.returnValue=1;CreateGrid("First")}alert($get(MasterObj+"txtAlert").value)}}}function OnClickBtnNext(){if(parseInt(document.getElementById("OToolBar_txtCurPage").value)<parseInt(document.getElementById("OToolBar_txtTotalPage").value)){CreateGrid("Next")}}function OnClickBtnPrv(){if(parseInt(document.getElementById("OToolBar_txtCurPage").value)>1){CreateGrid("Previous")}}function OnBlurtxtCurPage(){document.getElementById("OToolBar_txtCurPage").value=document.getElementById("OToolBar_txtCurPage").value.replace(" ","");var a=parseInt(document.getElementById("OToolBar_txtTotalPage").value);if(document.getElementById("OToolBar_txtCurPage").value!=""&&document.getElementById("OToolBar_txtCurPage").value!="0"){if(parseInt(document.getElementById("OToolBar_txtCurPage").value)<=parseInt(a)){document.getElementById(MasterObj+"txtCurPage").value=document.getElementById("OToolBar_txtCurPage").value}CreateGrid("Const")}}function OnClickBtnLast(){CreateGrid("Last")}function OnClickBtnFirst(){CreateGrid("First")}function OnClickGrd(a){if(LastSelectedRow!=null){LastSelectedRow.className=LastSelectedRowClass}LastSelectedRowClass=a.className;LastSelectedRow=a;a.className="CssSelectedItemStyle"}function ClearRowGrid(){var a=XTabTable;while(a.rows.length>0){a.deleteRow(a.rows.length-1)}}function CreateGrid(j){ClearRowGrid();var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML($get(MasterObj+"txtSaveXml").value);var b=e.documentElement.selectNodes("/Root/G");var c=e.documentElement.selectNodes("/Root/D");var f=e.documentElement.selectNodes("/Root/P");var g,m,k;g=f.length;k=c.length;m=b.length;$get(MasterObj+"lblTotal").value=g+m+k;var h;h=$get(MasterObj+"lblTotal").value;$get(MasterObj+"Totalpage").value=Math.ceil(h/PageSize);if(h>0){currentPage_X=parseInt((($get(MasterObj+"txtCurPage").value=="")?"1":$get(MasterObj+"txtCurPage").value));switch(j){case"Const":currentPage_X=currentPage_X;break;case"Next":currentPage_X=parseInt(currentPage_X)+1;break;case"Previous":currentPage_X=parseInt(currentPage_X)-1;break;case"First":currentPage_X=1;break;case"Last":currentPage_X=parseInt($get(MasterObj+"Totalpage").value);break}var l;if(currentPage_X*PageSize-1<0){return}if(h<=currentPage_X*PageSize-1){l=h-1}else{l=parseInt(currentPage_X)*PageSize-1}$get(MasterObj+"txtCurPage").value=currentPage_X;$get(MasterObj+"lblFrom").value=((currentPage_X-1)*PageSize)+1;$get(MasterObj+"lblTo").value=l+1;var d=(currentPage_X-1)*PageSize;for(;d<=l;d++){if(d<g){var a=""+f.item(d).selectSingleNode("ID").text+","+f.item(d).selectSingleNode("Name").text+",";AddToGrid("ID",f.item(d).selectSingleNode("ID").text,"Name",f.item(d).selectSingleNode("Name").text,"Type","P",a)}else{if(d<g+m){var a=""+b.item(d-g).selectSingleNode("ID").text+","+b.item(d-g).selectSingleNode("Name").text+",";AddToGrid("ID",b.item(d-g).selectSingleNode("ID").text,"Name",b.item(d-g).selectSingleNode("Name").text,"Type","G",a)}else{if(d<g+m+k){var a=""+c.item(d-g-m).selectSingleNode("ID").text+","+c.item(d-g-m).selectSingleNode("Name").text+",";AddToGrid("ID",c.item(d-g-m).selectSingleNode("ID").text,"Name",c.item(d-g-m).selectSingleNode("Name").text,"Type","D",a)}}}}}else{$get(MasterObj+"txtCurPage").value="0";$get(MasterObj+"lblFrom").value="0";$get(MasterObj+"lblTo").value="0";$get(MasterObj+"Totalpage").value="0";$get(MasterObj+"lblTotal").value="0"}SetPagingInfo()}function AddToGrid(h,o,g,m,f,k,a){var q=XTabTable;var b=q.insertRow();b.setAttribute(h,o);b.setAttribute(g,m);b.setAttribute(f,k);if((q.rows.length-1)%2==0){b.className="CssItemStyle"}else{b.className="CssAlternatingItemStyle"}b.style.height="25";var r=0;var c=new String;var d="";while(r<getCntChar(",",a)){d=getArray(a,r,",");switch(r){case 0:var l=b.insertCell();l.innerHTML="<INPUT type='checkbox' onclick='OnClickChk(this,-1)'  checked />";l.className="XTabTable";l.style.width="25px";l.align="center";break;case 1:var e="";var n="";switch(k){case"P":e="../../App_Utility/Images/Icons/Personel.gif";n="پرسنل";break;case"G":e="../../App_Utility/Images/Icons/PGroup.gif";n="گروه";break;case"D":e="../../App_Utility/Images/Icons/protectandshareworkbook.gif";n="واحدسازماني";break}var j=b.insertCell();j.innerHTML="<IMG src="+e+" title="+n+"  border='0'>";j.className="XTabTable";j.style.width="40px";j.align="center";var i=b.insertCell();i.innerText=((d.length>30)?d.substring(0,28)+"...":d);i.title=d;i.style.width="300px";i.align="center";break}r=r+1}}function SetPagingInfo(){document.getElementById("OToolBar_txtFromData").value=$get(MasterObj+"lblFrom").value;document.getElementById("OToolBar_txtToData").value=$get(MasterObj+"lblTo").value;document.getElementById("OToolBar_txtTotalData").value=$get(MasterObj+"lblTotal").value;document.getElementById("OToolBar_txtCurPage").value=$get(MasterObj+"txtCurPage").value;document.getElementById("OToolBar_txtTotalPage").value=$get(MasterObj+"Totalpage").value;if(document.getElementById("OToolBar_txtCurPage").value==""|document.getElementById("OToolBar_txtCurPage").value=="0"){document.getElementById("OToolBar_BtnPrv").disabled=true}else{document.getElementById("OToolBar_BtnPrv").disabled=false}if(parseInt(document.getElementById("OToolBar_txtCurPage").value)==parseInt(document.getElementById("OToolBar_txtTotalPage").value)){document.getElementById("OToolBar_BtnNext").disabled=true}else{document.getElementById("OToolBar_BtnNext").disabled=false}}function OnClickChk(g){var h;var d;h=g.parentElement.parentElement.ID;d=g.parentElement.parentElement.Type;var a=g.parentElement.parentElement.rowIndex;var c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML($get(MasterObj+"txtSaveXml").value);var b=c.documentElement.selectNodes("/Root/"+d+"[ID="+h+"]");if(g.checked==false&b.length!=0){var e=c.documentElement.removeChild(b.item(0));XTabTable.deleteRow(a)}$get(MasterObj+"txtSaveXml").value=c.xml;CreateGrid("Const")}function OnClickBtnSave(){if(CheckDate()){if($get(MasterObj+"txtSaveXml").value==""||$get(MasterObj+"txtSaveXml").value=="<Root/>"||$get(MasterObj+"txtSaveXml").value=="<Root></Root>"){alert("لطفا ابتدا اعضا را انتخاب نماييد");return}else{$get(MasterObj+"txtSubmit").value="Save";document.getElementById(MasterObj+"BtnSubmit").click()}}}function ModifyXML(a){if(a=="D"){OSelectedMamber=OSelectedMamber.substr(3,OSelectedMamber.length-3)}var g=new ActiveXObject("Microsoft.XMLDOM");g.async="false";g.loadXML(OSelectedMamber);var e=g.documentElement.selectNodes("/Root/Tb");var j=new ActiveXObject("Microsoft.XMLDOM");j.async="false";j.loadXML($get(MasterObj+"txtSaveXml").value);var d=j.documentElement.selectNodes("/Root/"+a);if(e.length>0){for(var f=0;f<e.length;f++){var k,h;switch(a){case"P":k=e.item(f).selectSingleNode("PID").text;h=e.item(f).selectSingleNode("PName").text;break;case"G":k=e.item(f).selectSingleNode("GroupId").text;h=e.item(f).selectSingleNode("GroupName").text;break;case"D":k=e.item(f).selectSingleNode("DID").text;h=e.item(f).selectSingleNode("DName").text;break}var b=j.documentElement.selectNodes("/Root/"+a+"[ID="+k+"]");if(b.length==0){var l=new ActiveXObject("Microsoft.XMLDOM");l.async="false";l.loadXML("<Root><"+a+"><ID>"+k+"</ID><Name>"+h+"</Name></"+a+"></Root>");var c=l.documentElement.selectNodes("/Root/"+a);j.childNodes[0].appendChild(c.item(0));$get(MasterObj+"txtSaveXml").value=j.xml}}}}function OnClickBtnSelect(){var b="";var a;var c;if(document.getElementById("RadPerson").checked){c="P";a="/FrmPresentation/App_Pages/BaseInfo/Person/SelectPerson.aspx?Type=Check&SessionID="+$get(MasterObj+"txtSessionID").value+"&CompanyPeriodID="+$get(MasterObj+"txtGetCompanyFinatialPeriodID").value+"&OnLineUser="+$get(MasterObj+"txtOnLineUser").value;b="dialogHeight: 640px;dialogWidth: 800px;center: Yes;help: no;status: no"}else{if(document.getElementById("RadGroup").checked){c="G";a="/FrmPresentation/App_Pages/BaseInfo/Group/selectGroup.aspx?Type=Check&SessionID="+$get(MasterObj+"txtSessionID").value+"&CompanyPeriodID="+$get(MasterObj+"txtGetCompanyFinatialPeriodID").value+"&OnLineUser="+$get(MasterObj+"txtOnLineUser").value;b="dialogHeight: 500px;dialogWidth: 600px;center: Yes;help: no;status: no"}else{if(document.getElementById("RadRole").checked){c="D";a="/FrmPresentation/App_Pages/BaseInfo/OrganizationChart/SelectDepartment.aspx?ShowFlag=0&SessionID="+$get(MasterObj+"txtSessionID").value+"&CompanyPeriodID="+$get(MasterObj+"txtGetCompanyFinatialPeriodID").value+"&OnLineUser="+$get(MasterObj+"txtOnLineUser").value;b="dialogHeight: 620px;dialogWidth: 720px;center: Yes;help: no;status: no"}}}if(a!=""){OSelectedMamber="";OSelectedMamber=window.showModalDialog(a,"",b);a=""}if(OSelectedMamber!=undefined&&OSelectedMamber!=""&&OSelectedMamber!="<Root></Root>"){if(document.getElementById("XTabTable").rows.length>0){if(confirm("پرسنل انتخاب شده جايگزين پرسنل قبلي گردند؟")){$get(MasterObj+"txtSaveXml").value="<Root></Root>"}}ModifyXML(c);if(OSelectedMamber!=""){CreateGrid("First")}}}function CheckDate(){$get(MasterObj+"SDate").value=$get(MasterObj+"KCalSDate_txtYear").value+"/"+$get(MasterObj+"KCalSDate_txtMonth").value+"/"+$get(MasterObj+"KCalSDate_txtDay").value;$get(MasterObj+"EDate").value=$get(MasterObj+"KCalEDate_txtYear").value+"/"+$get(MasterObj+"KCalEDate_txtMonth").value+"/"+$get(MasterObj+"KCalEDate_txtDay").value;$get(MasterObj+"txtGroupTypeTmp").value=$get(MasterObj+"CmbCreditType").value;if($get(MasterObj+"txtGroupTypeTmp").value=="0"||$get(MasterObj+"txtGroupTypeTmp").value==""){alert(" گروه مجوز را انتخاب کنيد");return false}else{if($get(MasterObj+"KCalSDate_txtYear").value==""||$get(MasterObj+"KCalSDate_txtMonth").value==""||$get(MasterObj+"KCalSDate_txtDay").value==""){alert("فرمت تاریخ شروع درست نمی باشد.");return false}else{if($get(MasterObj+"KCalEDate_txtYear").value==""||$get(MasterObj+"KCalEDate_txtMonth").value==""||$get(MasterObj+"KCalEDate_txtDay").value==""){alert("فرمت تاریخ خاتمه درست نمی باشد.");return false}else{if($get(MasterObj+"SDate").value>$get(MasterObj+"EDate").value){alert("تاریخ شروع باید از تاریخ خاتمه کوچکتر باشد.");return false}}}}return true}function OnClickBtnCancel(){window.close()};